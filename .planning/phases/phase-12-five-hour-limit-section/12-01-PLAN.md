---
phase: 12-five-hour-limit-section
plan: 01
type: execute
---

<objective>
Connect the 5-hour limit display to real JSONL data and fix header to match wireframe.

Purpose: The current ClaudeUsageCard uses hardcoded fake data (9% usage, "4h 38m" reset) instead of the real JSONL data that's already being fetched. Also fix the header which shows "Claude Code" with icon instead of just "Claude" as per wireframe.

Output: ClaudeUsageCard displays real 5-hour usage data from JSONL files with correct header text.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./12-01-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Wireframe reference:** ~/Desktop/claude.png

**Key files:**
@src/components/a2ui/ClaudeUsageCard.tsx (current implementation with fake data)
@server/claude-usage.ts (server-side JSONL parsing - already works)

**Current state analysis:**
The component already fetches real data via `mcpClient.getClaudeCodeUsage()` and stores it in state, but then uses hardcoded values:

```typescript
// Lines 19-22: Data IS being fetched
const [_claudeCode, setClaudeCode] = useState<ClaudeCodeUsage | null>(props.claudeCode);

// Lines 54-65: But NOT being used - hardcoded values instead
const fiveHourPercentage = 9;
const fiveHourRemaining = 91;
const resetsIn = '4h 38m';
```

**Header issue:**
- Current: "Claude Code" with Zap icon (line 86-87)
- Wireframe: Just "Claude" (no icon, large bold text)

**Data structure from server (ClaudeCodeUsage.fiveHourWindow):**
```typescript
interface FiveHourWindow {
  used: number;      // tokens used in window
  limit: number;     // plan limit (88000 for max5)
  percentage: number; // calculated percentage
  resetsAt: string;  // ISO timestamp
  resetsIn: string;  // human-readable "Xh Xm"
}
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix header to match wireframe</name>
  <files>src/components/a2ui/ClaudeUsageCard.tsx</files>
  <action>
Change the header section (lines 83-97) from:
```jsx
<div className="flex items-center gap-2">
  <Zap className="w-5 h-5 text-accent-primary" />
  <span className="widget-title">Claude Code</span>
</div>
```

To just:
```jsx
<h2 className="text-2xl font-bold text-gray-900">Claude</h2>
```

Remove the Zap icon import if no longer used elsewhere in the file.
Keep the refresh button on the right side of the header row.

The header should match the wireframe: Large, bold "Claude" text on the left, small refresh button on the right.
  </action>
  <verify>npm run build succeeds, no TypeScript errors about unused Zap import</verify>
  <done>Header shows "Claude" in large bold text without icon, matching wireframe</done>
</task>

<task type="auto">
  <name>Task 2: Connect 5-hour limit to real JSONL data</name>
  <files>src/components/a2ui/ClaudeUsageCard.tsx</files>
  <action>
Replace the hardcoded fake values with real data from the claudeCode state:

1. Rename `_claudeCode` back to `claudeCode` (remove underscore prefix)

2. Replace the hardcoded values (lines 54-65) with derived values from real data:
```typescript
// Get real data from fetched claudeCode, with fallbacks for loading state
const fiveHourData = claudeCode?.fiveHourWindow;
const fiveHourPercentage = fiveHourData?.percentage ?? 0;
const fiveHourRemaining = 100 - fiveHourPercentage;
const resetsIn = fiveHourData?.resetsIn ?? '5h 0m';

// Warning logic: show when 5-hour OR weekly limit exceeds 80%
const showWarning = fiveHourPercentage > 80 || weeklyPercentage > 80;

// Bar color based on real percentage
const barColor = fiveHourPercentage > 80 ? 'bg-red-500' : fiveHourPercentage > 60 ? 'bg-amber-500' : 'bg-blue-500';
```

3. Keep the weekly data as fake (hardcoded 22%/78%) - that's Phase 13 scope

4. The component already has:
   - Data fetching via mcpClient.getClaudeCodeUsage()
   - 5-minute auto-refresh interval
   - Manual refresh button
   These should continue to work with the real data.

IMPORTANT: Do not change the weekly limit section - keep it as fake data (22%/78%).
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>5-hour limit shows real percentage from JSONL data, real "Resets in" time, warning shows when >80%</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Connected 5-hour limit to real JSONL data with correct wireframe header</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Type "Show Claude usage" in chat to display the card
    4. Compare against wireframe at ~/Desktop/claude.png
    5. Verify:
       - Header shows "Claude" (large, bold, NO icon)
       - Refresh button is subtle, on the right
       - 5-hour limit shows REAL percentage (not always 9%)
       - "Resets in" shows actual time calculated from JSONL data
       - Progress bar color changes based on percentage (blue < 60%, amber 60-80%, red > 80%)
       - Weekly limit still shows fake 22%/78% data
       - Warning banner appears when 5-hour exceeds 80%
    6. Click refresh button - data should update
    7. Wait 5 minutes (or check console logs) - auto-refresh should trigger
  </how-to-verify>
  <resume-signal>Type "approved" if 5-hour limit shows real data, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] No TypeScript errors
- [ ] Header shows "Claude" (no icon)
- [ ] 5-hour limit displays real data from JSONL files
- [ ] Warning banner shows when percentage > 80%
- [ ] Refresh functionality works
- [ ] Human verified against wireframe
</verification>

<success_criteria>

- Header matches wireframe: "Claude" in large bold text, no icon
- 5-hour limit shows real percentage from JSONL data
- "Resets in" shows calculated time from oldest entry
- Progress bar color indicates usage level
- Warning banner displays conditionally
- Auto-refresh and manual refresh work
- No TypeScript errors
- Human verified
</success_criteria>

<output>
After completion, create `.planning/phases/phase-12-five-hour-limit-section/12-01-SUMMARY.md`:

# Phase 12 Plan 01: Five-Hour Limit Section Summary

**[One-liner describing what shipped]**

## Accomplishments

- [Key changes]

## Files Modified

- `src/components/a2ui/ClaudeUsageCard.tsx` - Connected to real JSONL data

## Decisions Made

[Any implementation choices]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Phase 13: Weekly Limit Section (refine weekly limit display)
</output>
